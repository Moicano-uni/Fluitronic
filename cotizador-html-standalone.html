<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizador Automático Perú - Productos Industriales</title>
    <meta name="description" content="Cotización automática de productos industriales en Perú mediante análisis de imágenes">
    <meta name="keywords" content="cotizador, perú, productos industriales, válvulas, acoples, ruedas">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .modal-backdrop {
            backdrop-filter: blur(5px);
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
    <div id="app" class="p-4">
        <div class="max-w-4xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800 mb-2">
                    Cotizador Automático Perú
                </h1>
                <p class="text-gray-600 text-lg">
                    Sube una foto y obtén cotizaciones instantáneas de productos industriales
                </p>
            </div>

            <!-- Upload Section -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="text-center">
                    <div id="upload-area" class="border-2 border-dashed border-gray-300 rounded-lg p-12 cursor-pointer hover:border-blue-500 transition-colors">
                        <div id="upload-placeholder">
                            <i data-lucide="camera" class="mx-auto h-16 w-16 text-gray-400 mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-700 mb-2">
                                Sube una foto del producto
                            </h3>
                            <p class="text-gray-500 mb-4">
                                Válvulas, acoples, ruedas, bandejas y más productos industriales
                            </p>
                            <button id="select-image-btn" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors flex items-center mx-auto">
                                <i data-lucide="upload" class="mr-2 h-5 w-5"></i>
                                Seleccionar imagen
                            </button>
                        </div>
                        
                        <div id="image-preview" class="hidden space-y-4">
                            <img id="preview-img" class="max-w-full max-h-80 mx-auto rounded-lg shadow-md">
                            <div class="flex justify-center space-x-4">
                                <button id="add-details-btn" class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 transition-colors flex items-center">
                                    <i data-lucide="search" class="mr-2 h-5 w-5"></i>
                                    Agregar detalles y cotizar
                                </button>
                                <button id="quote-direct-btn" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors flex items-center">
                                    <i data-lucide="search" class="mr-2 h-5 w-5"></i>
                                    Cotizar directo
                                </button>
                                <button id="reset-btn" class="bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition-colors">
                                    Nueva imagen
                                </button>
                            </div>
                        </div>
                    </div>

                    <input type="file" id="file-input" accept="image/*" class="hidden">

                    <div id="error-message" class="hidden mt-4 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center">
                        <i data-lucide="alert-circle" class="h-5 w-5 text-red-500 mr-2"></i>
                        <span class="text-red-700" id="error-text"></span>
                    </div>
                </div>
            </div>

            <!-- Loading Section -->
            <div id="loading-section" class="hidden bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="text-center">
                    <div class="loading-spinner mx-auto h-12 w-12 text-blue-600 mb-4">
                        <i data-lucide="loader-2" class="h-12 w-12"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Analizando imagen...</h3>
                    <p class="text-gray-600">Identificando productos y buscando precios</p>
                </div>
            </div>

            <!-- Results Section -->
            <div id="results-section" class="hidden space-y-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center mb-4">
                        <i data-lucide="check-circle" class="h-6 w-6 text-green-500 mr-2"></i>
                        <h2 class="text-2xl font-bold text-gray-800">
                            Productos detectados (<span id="product-count">0</span>)
                        </h2>
                    </div>
                    
                    <div id="products-grid" class="grid gap-6 md:grid-cols-1 lg:grid-cols-2">
                        <!-- Los productos se insertan aquí dinámicamente -->
                    </div>
                </div>
            </div>

            <!-- Features Section -->
            <div class="bg-white rounded-xl shadow-lg p-6 mt-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">
                    Características de la aplicación
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="text-center">
                        <i data-lucide="camera" class="h-12 w-12 text-blue-600 mx-auto mb-3"></i>
                        <h4 class="font-semibold text-gray-800 mb-2">Reconocimiento inteligente</h4>
                        <p class="text-gray-600 text-sm">
                            Identifica automáticamente productos industriales en tus fotos
                        </p>
                    </div>
                    <div class="text-center">
                        <i data-lucide="dollar-sign" class="h-12 w-12 text-green-600 mx-auto mb-3"></i>
                        <h4 class="font-semibold text-gray-800 mb-2">Precios actualizados</h4>
                        <p class="text-gray-600 text-sm">
                            Cotizaciones en tiempo real del mercado peruano
                        </p>
                    </div>
                    <div class="text-center">
                        <i data-lucide="map-pin" class="h-12 w-12 text-red-600 mx-auto mb-3"></i>
                        <h4 class="font-semibold text-gray-800 mb-2">Tiendas locales</h4>
                        <p class="text-gray-600 text-sm">
                            Encuentra dónde comprar cerca de ti en Perú
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Description Form -->
    <div id="description-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-90vh overflow-y-auto fade-in">
            <div class="p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">
                    Describe tu producto para mejor precisión
                </h3>
                <p class="text-gray-600 mb-6">
                    Proporciona detalles específicos para obtener cotizaciones más exactas
                </p>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Medidas y especificaciones técnicas
                        </label>
                        <textarea
                            id="measurements-input"
                            placeholder="Ej: Diámetro 1 pulgada, rosca NPT, longitud 15cm, capacidad 100kg, etc."
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            rows="3"
                        ></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Uso y aplicación
                        </label>
                        <textarea
                            id="usage-input"
                            placeholder="Ej: Para bandeja de aceite, sistema hidráulico, andamio móvil, control de flujo, etc."
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            rows="3"
                        ></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Material preferido
                        </label>
                        <input
                            type="text"
                            id="material-input"
                            placeholder="Ej: Acero inoxidable, latón, aluminio, goma, etc."
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        />
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Información adicional
                        </label>
                        <textarea
                            id="additional-input"
                            placeholder="Ej: Necesito con freno, resistente a químicos, para uso industrial, etc."
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            rows="2"
                        ></textarea>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-4 mt-6">
                    <button
                        id="cancel-description-btn"
                        class="px-6 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50"
                    >
                        Cancelar
                    </button>
                    <button
                        id="submit-description-btn"
                        class="px-8 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                    >
                        Cotizar con detalles
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Base de datos de productos (simulación)
        const productDatabase = {
            'valvula': {
                names: ['Válvula de bola 1"', 'Válvula de paso', 'Ball valve'],
                prices: { min: 50, max: 500 },
                stores: ['Sodimac', 'Promart', 'MercadoLibre'],
                description: 'Válvula de control de flujo industrial'
            },
            'acople': {
                names: ['Acople rápido 1"', 'Quick coupling', 'Conector rápido'],
                prices: { min: 80, max: 400 },
                stores: ['Ferropolis', 'MercadoLibre', 'Distribuidoras industriales'],
                description: 'Acople hidráulico de conexión rápida'
            },
            'rueda': {
                names: ['Rueda giratoria', 'Caster industrial', 'Garruchas'],
                prices: { min: 25, max: 120 },
                stores: ['Stalex', 'Sodimac', 'Promart'],
                description: 'Rueda giratoria para equipos móviles'
            },
            'bandeja': {
                names: ['Bandeja recolectora', 'Bandeja de aceite', 'Contenedor industrial'],
                prices: { min: 200, max: 800 },
                stores: ['Equipos industriales', 'MercadoLibre', 'Distribuidoras'],
                description: 'Bandeja para recolección de fluidos'
            }
        };

        // Variables globales
        let currentImage = null;
        let productDescription = {
            measurements: '',
            usage: '',
            material: '',
            additionalInfo: ''
        };

        // Inicializar iconos de Lucide
        lucide.createIcons();

        // Referencias DOM
        const fileInput = document.getElementById('file-input');
        const uploadArea = document.getElementById('upload-area');
        const uploadPlaceholder = document.getElementById('upload-placeholder');
        const imagePreview = document.getElementById('image-preview');
        const previewImg = document.getElementById('preview-img');
        const selectImageBtn = document.getElementById('select-image-btn');
        const addDetailsBtn = document.getElementById('add-details-btn');
        const quoteDirectBtn = document.getElementById('quote-direct-btn');
        const resetBtn = document.getElementById('reset-btn');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        const loadingSection = document.getElementById('loading-section');
        const resultsSection = document.getElementById('results-section');
        const productCount = document.getElementById('product-count');
        const productsGrid = document.getElementById('products-grid');
        const descriptionModal = document.getElementById('description-modal');
        const cancelDescriptionBtn = document.getElementById('cancel-description-btn');
        const submitDescriptionBtn = document.getElementById('submit-description-btn');

        // Event listeners
        selectImageBtn.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('click', () => {
            if (!currentImage) fileInput.click();
        });
        
        fileInput.addEventListener('change', handleImageUpload);
        addDetailsBtn.addEventListener('click', () => descriptionModal.classList.remove('hidden'));
        quoteDirectBtn.addEventListener('click', analyzeImage);
        resetBtn.addEventListener('click', resetApp);
        cancelDescriptionBtn.addEventListener('click', () => descriptionModal.classList.add('hidden'));
        submitDescriptionBtn.addEventListener('click', handleDescriptionSubmit);

        // Drag & Drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('border-blue-500');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('border-blue-500');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('border-blue-500');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            if (file.size > 10 * 1024 * 1024) {
                showError('La imagen debe ser menor a 10MB');
                return;
            }

            currentImage = file;
            hideError();

            const reader = new FileReader();
            reader.onload = (e) => {
                previewImg.src = e.target.result;
                uploadPlaceholder.classList.add('hidden');
                imagePreview.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }

        function handleDescriptionSubmit() {
            productDescription = {
                measurements: document.getElementById('measurements-input').value,
                usage: document.getElementById('usage-input').value,
                material: document.getElementById('material-input').value,
                additionalInfo: document.getElementById('additional-input').value
            };
            descriptionModal.classList.add('hidden');
            analyzeImage();
        }

        async function analyzeImage() {
            if (!currentImage) {
                showError('Por favor selecciona una imagen primero');
                return;
            }

            // Mostrar loading
            loadingSection.classList.remove('hidden');
            resultsSection.classList.add('hidden');
            hideError();

            // Simulación de análisis
            await new Promise(resolve => setTimeout(resolve, 3000));

            // Detectar productos basado en nombre de archivo y descripciones
            const imageName = currentImage.name.toLowerCase();
            const descriptionText = Object.values(productDescription).join(' ').toLowerCase();
            let detectedProducts = [];

            // Lógica de detección mejorada
            if (imageName.includes('valv') || descriptionText.includes('valv') || descriptionText.includes('paso') || Math.random() > 0.5) {
                detectedProducts.push('valvula');
            }
            if (imageName.includes('acople') || descriptionText.includes('acople') || descriptionText.includes('rapid') || Math.random() > 0.6) {
                detectedProducts.push('acople');
            }
            if (imageName.includes('rueda') || descriptionText.includes('rueda') || descriptionText.includes('caster') || Math.random() > 0.4) {
                detectedProducts.push('rueda');
            }
            if (imageName.includes('bandeja') || descriptionText.includes('bandeja') || Math.random() > 0.7) {
                detectedProducts.push('bandeja');
            }

            if (detectedProducts.length === 0) {
                const allProducts = Object.keys(productDatabase);
                detectedProducts = [allProducts[Math.floor(Math.random() * allProducts.length)]];
            }

            // Generar resultados
            const results = detectedProducts.map(productKey => {
                const product = productDatabase[productKey];
                let price = Math.floor(Math.random() * (product.prices.max - product.prices.min) + product.prices.min);

                // Ajustar precio según especificaciones
                if (productDescription.measurements.includes('2"') || productDescription.measurements.includes('3"')) {
                    price = Math.floor(price * 1.5);
                }
                if (productDescription.material.includes('inoxidable')) {
                    price = Math.floor(price * 1.3);
                }

                return {
                    id: productKey,
                    name: product.names[Math.floor(Math.random() * product.names.length)],
                    description: product.description,
                    price: price,
                    priceRange: `S/ ${product.prices.min} - S/ ${Math.floor(product.prices.max * 1.5)}`,
                    stores: product.stores,
                    confidence: Math.floor(Math.random() * 20 + 80),
                    availability: 'En stock',
                    estimatedDelivery: '2-5 días laborables',
                    userSpecs: productDescription
                };
            });

            displayResults(results);
        }

        function displayResults(results) {
            loadingSection.classList.add('hidden');
            resultsSection.classList.remove('hidden');
            
            productCount.textContent = results.length;
            productsGrid.innerHTML = '';

            results.forEach(product => {
                const productCard = createProductCard(product);
                productsGrid.appendChild(productCard);
            });

            lucide.createIcons();
        }

        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow fade-in';
            
            const hasSpecs = product.userSpecs && (
                product.userSpecs.measurements || 
                product.userSpecs.usage || 
                product.userSpecs.material || 
                product.userSpecs.additionalInfo
            );

            card.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <h3 class="text-xl font-semibold text-gray-800">${product.name}</h3>
                    <span class="bg-blue-100 text-blue-800 text-sm px-3 py-1 rounded-full">
                        ${product.confidence}% precisión
                    </span>
                </div>
                
                <p class="text-gray-600 mb-4">${product.description}</p>
                
                ${hasSpecs ? `
                <div class="bg-blue-50 p-4 rounded-lg mb-4">
                    <h5 class="font-semibold text-blue-800 mb-2">Especificaciones proporcionadas:</h5>
                    ${product.userSpecs.measurements ? `<p class="text-sm text-blue-700 mb-1"><strong>Medidas:</strong> ${product.userSpecs.measurements}</p>` : ''}
                    ${product.userSpecs.usage ? `<p class="text-sm text-blue-700 mb-1"><strong>Uso:</strong> ${product.userSpecs.usage}</p>` : ''}
                    ${product.userSpecs.material ? `<p class="text-sm text-blue-700 mb-1"><strong>Material:</strong> ${product.userSpecs.material}</p>` : ''}
                    ${product.userSpecs.additionalInfo ? `<p class="text-sm text-blue-700"><strong>Adicional:</strong> ${product.userSpecs.additionalInfo}</p>` : ''}
                </div>
                ` : ''}
                
                <div class="space-y-3">
                    <div class="flex items-center">
                        <i data-lucide="dollar-sign" class="h-5 w-5 text-green-600 mr-2"></i>
                        <span class="font-bold text-2xl text-green-600">S/ ${product.price}</span>
                        <span class="text-gray-500 ml-2">(${product.priceRange})</span>
                    </div>
                    
                    <div class="flex items-center">
                        <i data-lucide="shopping-cart" class="h-5 w-5 text-blue-600 mr-2"></i>
                        <span class="text-gray-700">${product.availability}</span>
                    </div>
                    
                    <div class="flex items-center">
                        <i data-lucide="map-pin" class="h-5 w-5 text-red-600 mr-2"></i>
                        <span class="text-gray-700">Entrega: ${product.estimatedDelivery}</span>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h4 class="font-semibold text-gray-800 mb-2">Dónde comprar:</h4>
                    <div class="flex flex-wrap gap-2">
                        ${product.stores.map(store => `
                            <span class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm">
                                ${store}
                            </span>
                        `).join('')}
                    </div>
                </div>
                
                <button class="w-full mt-4 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                    Ver detalles y comprar
                </button>
            `;

            return card;
        }

        function resetApp() {
            currentImage = null;
            productDescription = {
                measurements: '',
                usage: '',
                material: '',
                additionalInfo: ''
            };
            
            uploadPlaceholder.classList.remove('hidden');
            imagePreview.classList.add('hidden');
            loadingSection.classList.add('hidden');
            resultsSection.classList.add('hidden');
            descriptionModal.classList.add('hidden');
            hideError();
            fileInput.value = '';
            
            // Limpiar formulario
            document.getElementById('measurements-input').value = '';
            document.getElementById('usage-input').value = '';
            document.getElementById('material-input').value = '';
            document.getElementById('additional-input').value = '';
        }

        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
        }

        function hideError() {
            errorMessage.classList.add('hidden');
        }

        // Inicializar iconos al cargar la página
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });
    </script>
</body>
</html>